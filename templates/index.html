<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Les messagers du fion</title>
    <link href="{{ url_for('static', path='/style.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
</head>
<body>


<section class="section is-large pt-5 pb-5">
    <div class="columns ">
        <div class="full_height column is-one-fifth box mb-0" id="conversationsColumn">
            <!--  Conversations  -->
            <p>Conversations</p>

            <form method="" action="" id="conversationForm" class="mb-5" onsubmit="createConversation(event)">
                <div class="field is-grouped">
                    <div class="control is-expanded">
                    <!-- <textarea class="textarea" placeholder="Message" id="messageField"></textarea>-->
                        <input type="text" placeholder="Name" id="conversationField" class="input">
                    </div>
                    <div class="control">
                        <input type="submit" value="+" class="button">
                    </div>
                </div>
            </form>

        </div>
        <div class="full_height column box" id="messagesColumn">
            <!-- Add User to conversation -->
            <form method="" action="" id="addUserToConversationForm" class="mb-5" onsubmit="addUser(event)">
                <div class="field is-grouped">
                    <div class="control is-expanded">
                        <input type="text" placeholder="User ID" id="userIdField" class="input">
                    </div>
                    <div class="control">
                        <input type="submit" value="+" class="button">
                    </div>
                    <div class="control">
                        <p class="buttons">
                            <button class="button" onclick="listUsers()">
                                <span class="icon is-small">
                                    <i class="fas fa-info"></i>
                                </span>
                            </button>
                        </p>
                    </div>
                </div>
            </form>


            <!--    Messages    -->


            <!-- Message form -->
            <form method="" action="" id="messageForm" class="mb-0" onsubmit="sendMessage(event)">
                <div class="field is-grouped">
                    <div class="control is-expanded">
                    <!-- <textarea class="textarea" placeholder="Message" id="messageField"></textarea>-->
                        <input type="text" placeholder="Message" id="messageField" class="input">
                    </div>
                    <div class="control">
                        <input type="submit" value="Envoyer" class="button">
                    </div>
                </div>
            </form>
        </div>
    </div>


    <!--  Login Div  -->
    <div class="is-overlay box" id="loginDiv">

        <!--    Login Form    -->
        <form method="" action="" id="loginForm">
            <div class="field">
                <label class="label">Username</label>
                <div class="control">
                    <input type="text" placeholder="Username" id="usernameField" class="input is-primary">
                </div>
            </div>
            <div class="field">
                <label class="label">Password</label>
                <div class="control">
                    <input type="password" id="passwordField" placeholder="Password" class="input is-primary">
                </div>
            </div>
            <div class="field">
                <div class="control">
                    <input type="submit" value="Login" class="button">
                </div>
            </div>
        </form>
    </div>


    <!--  List users div  -->
    <div class="is-overlay box is-hidden" id="usersListDiv">
        <p class="buttons">
            <button class="button is-danger is-outlined is-pulled-right" onclick="hideListUsers()">
                <span>Close</span>
                <span class="icon is-small">
                    <i class="fas fa-times"></i>
                </span>
            </button>
        </p>
    </div>
</section>


<script>
    let clientId = "{{keycloak_client_id}}";

    let keycloakTokenUrl = "{{keycloak_token_url}}";
    let keycloakUsersUrl = "{{keycloak_users_url}}";
    // let external_keycloak_token_url = "{{external_keycloak_token_url}}"
    // let external
    let commandServer = "{{command_server}}";

    let accessToken = "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJQOW83aU9fdUpxLXdzRXg3VDhJdFpkbG13dE1aM3RBMDMxUHhsUkQ1eHUwIn0.eyJleHAiOjE2OTQ3MTgxNDQsImlhdCI6MTY5NDcxMDk0NCwianRpIjoiZDgxM2VhYmEtZTY4Mi00YzcwLWE0N2ItZjUyMzVmOGY1YmZmIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL3JlYWxtcy9wb2MiLCJhdWQiOlsicmVhbG0tbWFuYWdlbWVudCIsImFjY291bnQiXSwic3ViIjoiMzg2NmJkOTgtOGRjMi00ZGU2LWFhZDAtOGVmMWE0ZTlhMTEyIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoibG9naW4tY2xpZW50Iiwic2Vzc2lvbl9zdGF0ZSI6IjllOTQ1YWJjLTM1M2QtNGJmNi04M2FhLWFhZDFhMGQxZGIzMyIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiKiJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsiZGVmYXVsdC1yb2xlcy1wb2MiLCJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsicmVhbG0tbWFuYWdlbWVudCI6eyJyb2xlcyI6WyJ2aWV3LXVzZXJzIiwicXVlcnktZ3JvdXBzIiwicXVlcnktdXNlcnMiXX0sImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyIsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoicHJvZmlsZSBlbWFpbCIsInNpZCI6IjllOTQ1YWJjLTM1M2QtNGJmNi04M2FhLWFhZDFhMGQxZGIzMyIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJiYXN0aWVuIiwiZ2l2ZW5fbmFtZSI6IiIsImZhbWlseV9uYW1lIjoiIiwiZW1haWwiOiJiYXN0aWVuLmxhYm91Y2hlQGxpdmUuZnIifQ.rLE86uwYtYlV2N3j0uI4Ffk9c88-crOixoqYC6ArEHAW5NRO3_Xo8GaLlRwHDs4gokIE6FaS3f0Ro_QBlw9gpvAsJvA4aFs7Hbq2N2z8WGJ7BOmxwi7E6ZyKypZSfiYZOirQDiyMNylHaNXVMi_UDx7l8sr-jHcVQ_2Oa7DdI1m0DhcBZt_sJWi6lNKiYkm7PA7g_GGhWB-5VsZIdv_-VHZb7gt3_XicqZlA9Jb2EQEi7nwwZOqGksww2QIpvHSeUuLglhdsnJfxg96Oi0Zkf-GXs9SeHxKIZQR0EYVTLrctqzF_Dgo6Vw4r-887ZpjBCCjscQZBYhnHYXjnSWI64g";
    let refreshToken = "eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJhYzYzM2M3Yy03MGZjLTQzMmQtYTY5MC1lOTMzNGRkYzU1ZDYifQ.eyJleHAiOjE2OTQ1OTA0MjYsImlhdCI6MTY5NDU4ODYyNiwianRpIjoiMjNjZjc4MmEtYWJiOC00NGNhLWIzM2YtZGM4OGRjMzA3OTM1IiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL3JlYWxtcy9wb2MiLCJhdWQiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvcmVhbG1zL3BvYyIsInN1YiI6IjM4NjZiZDk4LThkYzItNGRlNi1hYWQwLThlZjFhNGU5YTExMiIsInR5cCI6IlJlZnJlc2giLCJhenAiOiJsb2dpbi1jbGllbnQiLCJzZXNzaW9uX3N0YXRlIjoiYjhjMmQ1N2EtMTJkMi00ZmVhLWI4NjItZmI3MTkwODAxN2M1Iiwic2NvcGUiOiJwcm9maWxlIGVtYWlsIiwic2lkIjoiYjhjMmQ1N2EtMTJkMi00ZmVhLWI4NjItZmI3MTkwODAxN2M1In0.q3lkh7GlwgU2tcaJxRzO3wKsWIE8S2QXSWR4CV2SO-I";

    let userIsLoggedIn = false;

    let socket = null;

</script>
<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>

<script src="{{ url_for('static', path='/users.js') }}"></script>
<script src="{{ url_for('static', path='/websockets.js') }}"></script>
<script src="{{ url_for('static', path='/messages.js') }}"></script>
<script src="{{ url_for('static', path='/conversations.js') }}"></script>
<script src="{{ url_for('static', path='/login.js') }}"></script>
</body>
</html>